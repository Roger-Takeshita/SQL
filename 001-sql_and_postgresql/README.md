<h1 id='table-of-contents'>TABLE OF CONTENTS</h1>

- [SQL AND POSTGRESQL](#sql-and-postgresql)
  - [Links](#links)
  - [Basics](#basics)
    - [Data Type](#data-type)
    - [CRUD](#crud)
      - [Create Table](#create-table)
      - [Insert Data](#insert-data)
      - [Select Data](#select-data)
      - [Update Data](#update-data)
      - [Delete Data](#delete-data)
    - [Math Operations](#math-operations)
    - [Name Custom Field](#name-custom-field)
    - [String Operations and Functions](#string-operations-and-functions)
  - [Filtering](#filtering)
    - [WHERE](#where)

# SQL AND POSTGRESQL

## Links

- [SQL On The Browser](https://pg-sql.com/)

## Basics

### Data Type

`VARCHAR`: Variable length character
`INTEGER`: Number without decimal, `-2.147.483.647 to +2.147.483.647`

### CRUD

#### Create Table

```SQL
  CREATE TABLE cities (
    name VARCHAR(50),
    country VARCHAR(50),
    population INTEGER,
    area INTEGER
  );
```

```SQL
  CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50)
  );

  -- SERIAL tells Postgres that this field will be generated by Postgres
  -- PRIMARY KEY
```

- `Keywords`: always capitalized
- `Identifiers`: always lowercase

- Create Table with `FOREIGN KEY`

  ```SQL
    CREATE TABLE photos (
      id SERIAL PRIMARY KEY,
      url VARCHAR(200),
      user_id INTEGER REFERENCES users(id)
    );
  ```

#### Insert Data

Insert single row

```SQL
  INSERT INTO
    cities (name, country, population, area)
  VALUES
    ('Tokyo', 'Japan', 38505000, 8223);
```

```SQL
  INSERT INTO users (username)
  VALUES
    ('monahan93'),
    ('pferrer'),
    ('si93onis'),
    ('99stroman');
```

```SQL
  INSERT INTO
    photos (url, user_id)
  VALUES
    ('http://rogertakeshita.com/1.png', 4),
    ('http://rogertakeshita.com/2.png', 1),
    ('http://rogertakeshita.com/25.png', 1),
    ('http://rogertakeshita.com/36.png', 1),
    ('http://rogertakeshita.com/754.png', 2),
    ('http://rogertakeshita.com/35.png', 3),
    ('http://rogertakeshita.com/2256.png', 4);
```

Insert multiple rows

```SQL
  INSERT INTO
    cities (name, country, population, area)
  VALUES
    ('Delhi', 'India', 2812500, 2240),
    ('Shanghai', 'China', 22125000, 4015),
    ('Sao Paulo', 'Brazil', 20935000, 3043);
```

#### Select Data

```SQL
  SELECT
    *
  FROM
    cities;
```

```SQL
  SELECT
    name, population, area
  FROM
    cities;
```

```SQL
  SELECT
    *
  FROM
    photos
  WHERE
    user_id = 4;
```

#### Update Data

```SQL
  UPDATE
    cities
  SET
    population = 39505000
  WHERE
    name = 'Tokyo';
```

#### Delete Data

```SQL
  DELETE FROM
    cities
  WHERE
    name = 'Tokyo';
```

On delete option

- `ON DELETE RESTRICT`, Throw an error **\*Default**
- `ON DELETE NO ACTION`, Throw an error
- `ON DELETE CASCADE`, Delete from associated tables
- `ON DELETE SET NULL`, Set the `user_id` of the associated tables to `NULL`
- `ON DELETE SET DEFAULT`, Set the `user_id` of the associated tables to a default value, if one is provided

```SQL
  CREATE TABLE photos (
    id SERIAL PRIMARY KEY,
    url VARCHAR(200),
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE
  );
  INSERT INTO
    photos (url, user_id)
  VALUES
    ('http:/one.jpg', 4),
    ('http:/two.jpg', 1),
    ('http:/25.jpg', 1),
    ('http:/36.jpg', 1),
    ('http:/754.jpg', 2),
    ('http:/35.jpg', 3),
    ('http:/256.jpg', 4);
```

```SQL
  CREATE TABLE photos (
    id SERIAL PRIMARY KEY,
    url VARCHAR(200),
    user_id INTEGER REFERENCES users(id) ON DELETE SET NULL
  );
  INSERT INTO
    photos (url, user_id)
  VALUES
    ('http:/one.jpg', 4),
    ('http:/754.jpg', 2),
    ('http:/35.jpg', 3),
    ('http:/256.jpg', 4);
```

### Math Operations

- `+` Add
- `-` Subtract
- `*` Multiply
- `/` Divide
- `^` Exponent
- `|/` Square root
- `@` Absolute value
- `%` Remainder
- `=` Are the values equal?
- `>` Is the value on the left greater?
- `<` Is the value on the left less?
- `>=` Is the value on the left greater or equal to?
- `<=` Is the value on the left lesser or equal to?
- `IN` Is the value present in a list?
- `<>` Are the values not equal?
- `!=` Are the values not equal?
- `BETWEEN` Is the value between two or other values?
- `NOT IN` Is the value not present in a list?

```SQL
  SELECT
    name, population / area
  FROM
    cities;
```

### Name Custom Field

```SQL
  SELECT
    name, population / area AS population_density
  FROM
    cities;
```

```SQL
  SELECT
    name, price * units_sold AS revenue
  FROM
    phones;
```

### String Operations and Functions

- `||` Join two strings
- `CONCAT()` Join two strings
- `LOWER()` Gives a lower case string
- `LENGTH()` Gives number of characters in a string
- `UPPER()` Gives an upper case string

```SQL
  SELECT
    name || ', ' || country AS location
  FROM
      cities;

  -- OR

  SELECT
    CONCAT(name, ', ', country) AS location
  FROM
      cities;
```

```SQL
  SELECT
    CONCAT(UPPER(name), ', ', UPPER(country)) AS location
  FROM
      cities;

  -- OR

  SELECT
    UPPER(CONCAT(name, ', ', country)) AS location
  FROM
    cities;
```

## Filtering

Order

```SQL
  SELECT name FROM cities WHERE area > 4000;
  -- |          |          └── Second
  -- |          └── First
  -- └── Third
```

### WHERE

- Greater

  ```SQL
    SELECT
      name, area
    FROM
      cities
    WHERE
      area > 4000;
  ```

- Equal

  ```SQL
    SELECT
      name, area
    FROM
      cities
    WHERE
      area = 8223;
  ```

- Not Equal

  ```SQL
    SELECT
      name, area
    FROM
      cities
    WHERE
      area != 8223;

    -- OR

    SELECT
      name, area
    FROM
      cities
    WHERE
      area <> 8223;
  ```

- BETWEEN

  ```SQL
    SELECT
      name, area
    FROM
      cities
    WHERE
      area BETWEEN 2000 AND 4000;
  ```

- IN

  ```SQL
    SELECT
      name, area
    FROM
      cities
    WHERE
      name IN ('Delhi', 'Shanghai');
  ```

  ```SQL
    SELECT
      name, area
    FROM
      cities
    WHERE
      name NOT IN ('Delhi', 'Shanghai');
  ```

  ```SQL
    SELECT
      name, area
    FROM
      cities
     WHERE
       area NOT IN (3043, 8223);
  ```

- Chaining

  ```SQL
    SELECT
      name, area
    FROM
      cities
    WHERE
      area NOT IN (3043, 8223) AND name = 'Delhi';
  ```

  ```SQL
    SELECT
      name,
      area
    FROM
      cities
    WHERE
      area NOT IN (3043, 8223)
      OR name = 'Delhi'
      OR name = 'Tokyo';
  ```

- Calculation

  ```SQL
    SELECT
      name,
      population / area AS population_density
    FROM
      cities
    WHERE
      population / area > 6000;
  ```
